import { PrismaClient } from '../generated/prisma/client/client.ts';
import { PrismaPg } from '@prisma/adapter-pg';
import { Pool } from 'pg';
import * as bcrypt from 'bcrypt';
import 'dotenv/config';

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

const adapter = new PrismaPg(pool);
const prisma = new PrismaClient({ adapter });

async function main() {
  console.log('ðŸŒ± Starting database seeding...');
  console.log('Prisma models:', Object.keys(prisma).filter(k => !k.startsWith('_') && !k.startsWith('$')).slice(0, 10));

  // Clear existing data
  console.log('ðŸ§¹ Cleaning existing data...');
  await prisma.$transaction([
    prisma.payment.deleteMany(),
    prisma.bookingItem.deleteMany(),
    prisma.booking.deleteMany(),
    prisma.review.deleteMany(),
    prisma.photo.deleteMany(),
    prisma.service.deleteMany(),
    prisma.supplierApiKey.deleteMany(),
    prisma.supplierAddon.deleteMany(),
    prisma.subscription.deleteMany(),
    prisma.supplier.deleteMany(),
    prisma.userPreferences.deleteMany(),
    prisma.userInteraction.deleteMany(),
    prisma.recommendationScore.deleteMany(),
    prisma.smartSuggestion.deleteMany(),
    prisma.chatMessage.deleteMany(),
    prisma.chatConversation.deleteMany(),
    prisma.storyLike.deleteMany(),
    prisma.storyComment.deleteMany(),
    prisma.itineraryLike.deleteMany(),
    prisma.itineraryComment.deleteMany(),
    prisma.userActivity.deleteMany(),
    prisma.friendship.deleteMany(),
    prisma.travelStory.deleteMany(),
    prisma.sharedItinerary.deleteMany(),
    prisma.tripItinerary.deleteMany(),
    prisma.notification.deleteMany(),
    prisma.location.deleteMany(),
    prisma.user.deleteMany(),
  ]);

  console.log('âœ… Data cleared');

  // 1. Create Users
  console.log('ðŸ‘¥ Creating users...');
  const hashedPassword = await bcrypt.hash('password123', 10);

  const admin = await prisma.user.create({
    data: {
      email: 'admin@croffers.com',
      password: hashedPassword,
      firstName: 'Admin',
      lastName: 'User',
      role: 'ADMIN',
      isEmailVerified: true,
    },
  });

  const tourists = await Promise.all([
    prisma.user.create({
      data: {
        email: 'john@example.com',
        password: hashedPassword,
        firstName: 'John',
        lastName: 'Doe',
        role: 'TOURIST',
        isEmailVerified: true,
      },
    }),
    prisma.user.create({
      data: {
        email: 'sarah@example.com',
        password: hashedPassword,
        firstName: 'Sarah',
        lastName: 'Wilson',
        role: 'TOURIST',
        isEmailVerified: true,
      },
    }),
    prisma.user.create({
      data: {
        email: 'mike@example.com',
        password: hashedPassword,
        firstName: 'Mike',
        lastName: 'Johnson',
        role: 'TOURIST',
        isEmailVerified: true,
      },
    }),
    prisma.user.create({
      data: {
        email: 'emma@example.com',
        password: hashedPassword,
        firstName: 'Emma',
        lastName: 'Brown',
        role: 'TOURIST',
        isEmailVerified: true,
      },
    }),
  ]);

  const supplierUsers = await Promise.all([
    prisma.user.create({
      data: {
        email: 'supplier1@example.com',
        password: hashedPassword,
        firstName: 'Ivan',
        lastName: 'Horvat',
        role: 'SUPPLIER',
        isEmailVerified: true,
      },
    }),
    prisma.user.create({
      data: {
        email: 'supplier2@example.com',
        password: hashedPassword,
        firstName: 'Ana',
        lastName: 'KovaÄ',
        role: 'SUPPLIER',
        isEmailVerified: true,
      },
    }),
    prisma.user.create({
      data: {
        email: 'supplier3@example.com',
        password: hashedPassword,
        firstName: 'Marko',
        lastName: 'Novak',
        role: 'SUPPLIER',
        isEmailVerified: true,
      },
    }),
  ]);

  console.log(`âœ… Created ${tourists.length + supplierUsers.length + 1} users`);

  // 2. Create Locations
  console.log('ðŸ“ Creating locations...');
  const locations = await Promise.all([
    prisma.location.create({
      data: {
        name: 'Dubrovnik',
        slug: 'dubrovnik',
        description:
          'The Pearl of the Adriatic, famous for its stunning Old Town and medieval walls.',
        region: 'Dalmatia',
        coordinates: { lat: 42.6507, lng: 18.0944 },
        type: 'CITY',
        photos: [
          'https://images.unsplash.com/photo-1555990538-c5e0d8f1f3c3',
        ],
        isActive: true,
      },
    }),
    prisma.location.create({
      data: {
        name: 'Split',
        slug: 'split',
        description:
          "Croatia's second-largest city, home to the magnificent Diocletian's Palace.",
        region: 'Dalmatia',
        coordinates: { lat: 43.5081, lng: 16.4402 },
        type: 'CITY',
        photos: ['https://images.unsplash.com/photo-1623752824386-e2c4058d5b3c'],
        isActive: true,
      },
    }),
    prisma.location.create({
      data: {
        name: 'Hvar',
        slug: 'hvar',
        description:
          'Stunning island known for lavender fields, beaches, and vibrant nightlife.',
        region: 'Dalmatia',
        coordinates: { lat: 43.1729, lng: 16.4411 },
        type: 'ISLAND',
        photos: ['https://images.unsplash.com/photo-1559827260-dc66d52bef19'],
        isActive: true,
      },
    }),
    prisma.location.create({
      data: {
        name: 'Zagreb',
        slug: 'zagreb',
        description:
          'The capital city with charming Upper Town and vibrant cultural scene.',
        region: 'Central Croatia',
        coordinates: { lat: 45.815, lng: 15.9819 },
        type: 'CITY',
        photos: ['https://images.unsplash.com/photo-1614707267808-0cc30d1b5b2c'],
        isActive: true,
      },
    }),
    prisma.location.create({
      data: {
        name: 'Plitvice Lakes',
        slug: 'plitvice-lakes',
        description:
          'UNESCO World Heritage site with cascading lakes and waterfalls.',
        region: 'Lika',
        coordinates: { lat: 44.8654, lng: 15.5821 },
        type: 'LANDMARK',
        photos: ['https://images.unsplash.com/photo-1623114442830-f50d4ab43cb5'],
        isActive: true,
      },
    }),
    prisma.location.create({
      data: {
        name: 'Zadar',
        slug: 'zadar',
        description: 'Ancient city famous for Sea Organ and stunning sunsets.',
        region: 'Dalmatia',
        coordinates: { lat: 44.1194, lng: 15.2314 },
        type: 'CITY',
        photos: ['https://images.unsplash.com/photo-1555881593-a165c9af6970'],
        isActive: true,
      },
    }),
  ]);

  console.log(`âœ… Created ${locations.length} locations`);

  // 3. Create Suppliers
  console.log('ðŸ¢ Creating suppliers...');
  const suppliers = await Promise.all([
    prisma.supplier.create({
      data: {
        userId: supplierUsers[0].id,
        businessName: 'Adriatic Luxury Stays',
        description: 'Premium accommodations across the Croatian coast',
        businessType: 'HOTEL',
        businessRegistration: 'HR-123456789',
        taxId: 'HR12345678901',
        address: 'Ul. Sv. Dominika 1, Dubrovnik',
        phone: '+385 20 123 4567',
        website: 'https://adriaticluxury.com',
        status: 'APPROVED',
        rating: 4.8,
        totalReviews: 45,
      },
    }),
    prisma.supplier.create({
      data: {
        userId: supplierUsers[1].id,
        businessName: 'Dalmatian Adventures',
        description: 'Exciting tours and activities in Split region',
        businessType: 'TOUR_OPERATOR',
        businessRegistration: 'HR-987654321',
        taxId: 'HR98765432109',
        address: 'Obala Hrvatskog narodnog preporoda 10, Split',
        phone: '+385 21 987 6543',
        website: 'https://dalmatianadventures.com',
        status: 'APPROVED',
        rating: 4.9,
        totalReviews: 78,
      },
    }),
    prisma.supplier.create({
      data: {
        userId: supplierUsers[2].id,
        businessName: 'Island Hopper Ferries',
        description: 'Fast and comfortable ferry services',
        businessType: 'TRANSPORTATION',
        businessRegistration: 'HR-555666777',
        taxId: 'HR55566677788',
        address: 'Obala kneza Domagoja 1, Split',
        phone: '+385 21 555 6667',
        website: 'https://islandhopper.hr',
        status: 'APPROVED',
        rating: 4.6,
        totalReviews: 123,
      },
    }),
  ]);

  console.log(`âœ… Created ${suppliers.length} suppliers`);

  // 4. Create Services
  console.log('ðŸ¨ Creating services...');

  // Accommodations
  const accommodations = await Promise.all([
    prisma.service.create({
      data: {
        name: 'Luxury Villa with Sea View',
        slug: 'luxury-villa-sea-view-dubrovnik',
        description:
          'Stunning 4-bedroom villa with infinity pool overlooking the Adriatic Sea. Perfect for families or groups seeking privacy and luxury.',
        type: 'ACCOMMODATION',
        supplierId: suppliers[0].id,
        locationId: locations[0].id, // Dubrovnik
        price: 350,
        currency: 'EUR',
        capacity: 8,
        isActive: true,
        status: 'ACTIVE',
        amenities: [
          'Pool',
          'WiFi',
          'Air Conditioning',
          'Kitchen',
          'Sea View',
          'Parking',
        ],
        details: {
          bedrooms: 4,
          bathrooms: 3,
          checkInTime: '15:00',
          checkOutTime: '11:00',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9',
              caption: 'Villa exterior with sea view',
              isMain: true,
              order: 1,
            },
            {
              url: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c',
              caption: 'Living room',
              isMain: false,
              order: 2,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Boutique Hotel in Old Town',
        slug: 'boutique-hotel-old-town-dubrovnik',
        description:
          'Charming boutique hotel in the heart of Dubrovnik Old Town with modern amenities and historic charm.',
        type: 'ACCOMMODATION',
        supplierId: suppliers[0].id,
        locationId: locations[0].id,
        price: 180,
        currency: 'EUR',
        capacity: 2,
        isActive: true,
        status: 'ACTIVE',
        amenities: ['WiFi', 'Air Conditioning', 'Breakfast', 'City Center'],
        details: {
          roomType: 'Double Room',
          checkInTime: '14:00',
          checkOutTime: '12:00',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1566073771259-6a8506099945',
              caption: 'Hotel room',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Modern Apartment in Split Center',
        slug: 'modern-apartment-split-center',
        description:
          '2-bedroom apartment near Diocletian Palace, perfect for exploring Split.',
        type: 'ACCOMMODATION',
        supplierId: suppliers[0].id,
        locationId: locations[1].id, // Split
        price: 120,
        currency: 'EUR',
        capacity: 4,
        isActive: true,
        status: 'ACTIVE',
        amenities: ['WiFi', 'Air Conditioning', 'Kitchen', 'Washing Machine'],
        details: {
          bedrooms: 2,
          bathrooms: 1,
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267',
              caption: 'Living area',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Beachfront Villa Hvar',
        slug: 'beachfront-villa-hvar',
        description:
          'Exclusive villa right on the beach with private access and stunning sunset views.',
        type: 'ACCOMMODATION',
        supplierId: suppliers[0].id,
        locationId: locations[2].id, // Hvar
        price: 450,
        currency: 'EUR',
        capacity: 10,
        isActive: true,
        status: 'ACTIVE',
        amenities: [
          'Pool',
          'Beach Access',
          'WiFi',
          'BBQ',
          'Sea View',
          'Boat Mooring',
        ],
        details: {
          bedrooms: 5,
          bathrooms: 4,
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9',
              caption: 'Beach villa exterior',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
  ]);

  // Tours & Activities
  const tours = await Promise.all([
    prisma.service.create({
      data: {
        name: 'Game of Thrones Walking Tour',
        slug: 'game-of-thrones-walking-tour-dubrovnik',
        description:
          'Explore the filming locations of Game of Thrones in Dubrovnik with expert guide.',
        type: 'TOUR',
        supplierId: suppliers[1].id,
        locationId: locations[0].id,
        price: 35,
        currency: 'EUR',
        capacity: 15,
        duration: 180, // 3 hours
        isActive: true,
        status: 'ACTIVE',
        amenities: ['Guide', 'Photos', 'Small Group'],
        details: {
          languages: ['English', 'German', 'Spanish'],
          meetingPoint: 'Pile Gate',
          difficulty: 'Easy',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1602491453631-e2a5ad90a131',
              caption: 'Tour group at King\'s Landing',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Blue Cave & Island Hopping Tour',
        slug: 'blue-cave-island-hopping-tour-split',
        description:
          'Full-day speedboat tour visiting Blue Cave, Vis, and Hvar islands.',
        type: 'TOUR',
        supplierId: suppliers[1].id,
        locationId: locations[1].id,
        price: 95,
        currency: 'EUR',
        capacity: 12,
        duration: 600, // 10 hours
        isActive: true,
        status: 'ACTIVE',
        amenities: [
          'Speedboat',
          'Lunch',
          'Snorkeling Gear',
          'Drinks',
          'Guide',
        ],
        details: {
          departure: '08:00',
          return: '18:00',
          included: ['Blue Cave entrance', 'Lunch', 'Snorkeling'],
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5',
              caption: 'Speedboat on crystal waters',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Plitvice Lakes National Park Tour',
        slug: 'plitvice-lakes-tour',
        description:
          'Guided tour of UNESCO World Heritage Plitvice Lakes with transportation from Split.',
        type: 'TOUR',
        supplierId: suppliers[1].id,
        locationId: locations[4].id, // Plitvice
        price: 75,
        currency: 'EUR',
        capacity: 20,
        duration: 720, // 12 hours
        isActive: true,
        status: 'ACTIVE',
        amenities: ['Transport', 'Guide', 'Park Entry', 'Lunch'],
        details: {
          pickup: ['Split', 'Trogir'],
          difficulty: 'Moderate',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1567225591450-8ad43ad3c018',
              caption: 'Plitvice waterfalls',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Sunset Sea Kayaking',
        slug: 'sunset-sea-kayaking-dubrovnik',
        description:
          'Paddle along the Dubrovnik coast during golden hour with cave exploration.',
        type: 'ACTIVITY',
        supplierId: suppliers[1].id,
        locationId: locations[0].id,
        price: 45,
        currency: 'EUR',
        capacity: 10,
        duration: 150, // 2.5 hours
        isActive: true,
        status: 'ACTIVE',
        amenities: [
          'Kayak',
          'Life Jacket',
          'Dry Bag',
          'Photos',
          'Snorkeling',
        ],
        details: {
          difficulty: 'Easy to Moderate',
          age: '12+',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1544551763-77ef2d0cfc6c',
              caption: 'Kayaking at sunset',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Wine Tasting Tour PeljeÅ¡ac',
        slug: 'wine-tasting-tour-peljesac',
        description:
          'Visit three family wineries on PeljeÅ¡ac peninsula with traditional lunch.',
        type: 'TOUR',
        supplierId: suppliers[1].id,
        locationId: locations[0].id,
        price: 85,
        currency: 'EUR',
        capacity: 8,
        duration: 480, // 8 hours
        isActive: true,
        status: 'ACTIVE',
        amenities: ['Transport', 'Wine Tastings', 'Lunch', 'Guide'],
        details: {
          wineries: 3,
          wines: '12+ varieties',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3',
              caption: 'Vineyard views',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
  ]);

  // Transport
  const transport = await Promise.all([
    prisma.service.create({
      data: {
        name: 'Ferry Split - Hvar',
        slug: 'ferry-split-hvar',
        description: 'Fast catamaran service between Split and Hvar Town.',
        type: 'TRANSPORT',
        supplierId: suppliers[2].id,
        locationId: locations[1].id,
        price: 25,
        currency: 'EUR',
        capacity: 150,
        duration: 60,
        isActive: true,
        status: 'ACTIVE',
        amenities: ['Air Conditioning', 'WiFi', 'Cafe', 'Deck Seating'],
        details: {
          route: 'Split - Hvar Town',
          frequency: 'Daily',
          departures: ['09:00', '14:00', '18:30'],
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1544552866-d3ed42536cfd',
              caption: 'Catamaran ferry',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
    prisma.service.create({
      data: {
        name: 'Private Transfer Dubrovnik Airport',
        slug: 'private-transfer-dubrovnik-airport',
        description:
          'Comfortable private transfer from Dubrovnik Airport to city center or hotels.',
        type: 'TRANSPORT',
        supplierId: suppliers[2].id,
        locationId: locations[0].id,
        price: 40,
        currency: 'EUR',
        capacity: 4,
        duration: 30,
        isActive: true,
        status: 'ACTIVE',
        amenities: ['Air Conditioning', 'WiFi', 'Luggage Assistance'],
        details: {
          vehicleType: 'Sedan',
          waitTime: '60 minutes free',
        },
        photos: {
          create: [
            {
              url: 'https://images.unsplash.com/photo-1449965408869-eaa3f722e40d',
              caption: 'Private car',
              isMain: true,
              order: 1,
            },
          ],
        },
      },
    }),
  ]);

  const allServices = [...accommodations, ...tours, ...transport];
  console.log(`âœ… Created ${allServices.length} services`);

  // 5. Create Tourist Subscriptions
  console.log('ðŸ’³ Creating subscriptions...');
  await prisma.subscription.create({
    data: {
      userId: tourists[0].id, // John has premium
      plan: 'PREMIUM_YEARLY',
      status: 'ACTIVE',
      startDate: new Date(),
      endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),
      amount: 49,
      currency: 'EUR',
      stripeSubscriptionId: 'sub_test_premium_yearly',
    },
  });

  await prisma.subscription.create({
    data: {
      userId: tourists[1].id, // Sarah has monthly premium
      plan: 'PREMIUM_MONTHLY',
      status: 'ACTIVE',
      startDate: new Date(),
      endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
      amount: 4.99,
      currency: 'EUR',
      stripeSubscriptionId: 'sub_test_premium_monthly',
    },
  });

  console.log('âœ… Created 2 premium subscriptions');

  // 6. Create Supplier Premium Add-ons
  console.log('â­ Creating supplier add-ons...');
  await Promise.all([
    prisma.supplierAddon.create({
      data: {
        supplierId: suppliers[0].id,
        addonType: 'ANALYTICS_PRO',
        status: 'ACTIVE',
        startDate: new Date(),
        amount: 29,
        currency: 'EUR',
        stripeSubscriptionId: 'sub_addon_analytics',
      },
    }),
    prisma.supplierAddon.create({
      data: {
        supplierId: suppliers[0].id,
        addonType: 'MARKETING_SUITE',
        status: 'ACTIVE',
        startDate: new Date(),
        amount: 39,
        currency: 'EUR',
        stripeSubscriptionId: 'sub_addon_marketing',
      },
    }),
    prisma.supplierAddon.create({
      data: {
        supplierId: suppliers[1].id,
        addonType: 'COMMISSION_REDUCTION',
        status: 'ACTIVE',
        startDate: new Date(),
        amount: 99,
        currency: 'EUR',
        stripeSubscriptionId: 'sub_addon_commission',
      },
    }),
  ]);

  console.log('âœ… Created 3 supplier add-ons');

  // 7. Create Bookings
  console.log('ðŸ“… Creating bookings...');

  // Confirmed booking
  const booking1 = await prisma.booking.create({
    data: {
      userId: tourists[0].id,
      reference: 'CR-100001',
      status: 'CONFIRMED',
      guestName: 'John Doe',
      guestEmail: 'john@example.com',
      guestPhone: '+1234567890',
      groupSize: 2,
      totalPrice: 700,
      currency: 'EUR',
      bookingItems: {
        create: [
          {
            serviceId: accommodations[0].id,
            quantity: 1,
            unitPrice: 350,
            checkIn: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000),
            checkOut: new Date(Date.now() + 16 * 24 * 60 * 60 * 1000),
          },
        ],
      },
      payment: {
        create: {
          userId: tourists[0].id,
          amount: 700,
          currency: 'EUR',
          status: 'COMPLETED',
          method: 'CARD',
          stripePaymentIntentId: 'pi_test_booking1',
        },
      },
    },
  });

  // Pending booking
  await prisma.booking.create({
    data: {
      userId: tourists[1].id,
      reference: 'CR-100002',
      status: 'PENDING',
      guestName: 'Sarah Wilson',
      guestEmail: 'sarah@example.com',
      guestPhone: '+1234567891',
      groupSize: 4,
      totalPrice: 360,
      currency: 'EUR',
      bookingItems: {
        create: [
          {
            serviceId: accommodations[2].id,
            quantity: 1,
            unitPrice: 120,
            checkIn: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
            checkOut: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000),
          },
        ],
      },
    },
  });

  // Completed booking with review
  const booking3 = await prisma.booking.create({
    data: {
      userId: tourists[2].id,
      reference: 'CR-100003',
      status: 'COMPLETED',
      guestName: 'Mike Johnson',
      guestEmail: 'mike@example.com',
      guestPhone: '+1234567892',
      groupSize: 1,
      totalPrice: 35,
      currency: 'EUR',
      bookingItems: {
        create: [
          {
            serviceId: tours[0].id,
            quantity: 1,
            unitPrice: 35,
            checkIn: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
            checkOut: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
          },
        ],
      },
      payment: {
        create: {
          userId: tourists[2].id,
          amount: 35,
          currency: 'EUR',
          status: 'COMPLETED',
          method: 'CARD',
          stripePaymentIntentId: 'pi_test_booking3',
        },
      },
    },
  });

  // Group booking
  await prisma.booking.create({
    data: {
      userId: tourists[3].id,
      reference: 'CR-100004',
      status: 'CONFIRMED',
      guestName: 'Emma Brown',
      guestEmail: 'emma@example.com',
      guestPhone: '+1234567893',
      groupSize: 12,
      totalPrice: 1140,
      currency: 'EUR',
      bookingItems: {
        create: [
          {
            serviceId: tours[1].id,
            quantity: 12,
            unitPrice: 95,
            checkIn: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000),
            checkOut: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000),
          },
        ],
      },
      payment: {
        create: {
          userId: tourists[3].id,
          amount: 1140,
          currency: 'EUR',
          status: 'COMPLETED',
          method: 'CARD',
          stripePaymentIntentId: 'pi_test_booking4',
        },
      },
    },
  });

  console.log('âœ… Created 4 bookings');

  // 8. Create Reviews
  console.log('â­ Creating reviews...');
  await Promise.all([
    prisma.review.create({
      data: {
        userId: tourists[2].id,
        supplierId: suppliers[1].id,
        serviceId: tours[0].id,
        bookingId: booking3.id,
        wouldRecommend: true,
        comment:
          "Amazing tour! Our guide was incredibly knowledgeable about the filming locations. A must-do for any GoT fan visiting Dubrovnik. Highly recommend!",
        tags: ['Great Guide', 'Fun', 'Informative'],
        isVerified: true,
      },
    }),
    prisma.review.create({
      data: {
        userId: tourists[0].id,
        supplierId: suppliers[0].id,
        serviceId: accommodations[0].id,
        bookingId: booking1.id,
        wouldRecommend: true,
        comment:
          'Stunning villa with breathtaking sea views. The infinity pool was perfect for relaxation. Host was very responsive and helpful.',
        tags: ['Beautiful', 'Clean', 'Great Location'],
        isVerified: true,
      },
    }),
    prisma.review.create({
      data: {
        userId: tourists[1].id,
        supplierId: suppliers[1].id,
        serviceId: tours[1].id,
        wouldRecommend: true,
        comment:
          'Best tour we did in Croatia! The Blue Cave was magical and our skipper was friendly and professional. Worth every euro!',
        tags: ['Amazing', 'Professional', 'Beautiful'],
        isVerified: false,
      },
    }),
    prisma.review.create({
      data: {
        userId: tourists[3].id,
        supplierId: suppliers[0].id,
        serviceId: accommodations[1].id,
        wouldRecommend: true,
        comment:
          'Perfect location in the Old Town. Room was cozy and breakfast was delicious. Would definitely stay again!',
        tags: ['Great Location', 'Cozy', 'Good Breakfast'],
        isVerified: false,
      },
    }),
  ]);

  console.log('âœ… Created 4 reviews');

  // 9. Create AI Preferences
  console.log('ðŸ¤– Creating user preferences...');
  await Promise.all([
    prisma.userPreferences.create({
      data: {
        userId: tourists[0].id,
        travelStyles: ['LUXURY', 'ADVENTURE'],
        interests: ['BEACHES', 'WATER_SPORTS', 'PHOTOGRAPHY'],
        minBudget: 100,
        maxBudget: 500,
      },
    }),
    prisma.userPreferences.create({
      data: {
        userId: tourists[1].id,
        travelStyles: ['CULTURAL', 'FOODIE'],
        interests: ['HISTORY', 'FOOD', 'WINE', 'LOCAL_CULTURE'],
        minBudget: 50,
        maxBudget: 200,
      },
    }),
    prisma.userPreferences.create({
      data: {
        userId: tourists[2].id,
        travelStyles: ['ADVENTURE', 'BACKPACKER'],
        interests: ['HIKING', 'NATURE', 'NIGHTLIFE'],
        minBudget: 20,
        maxBudget: 100,
      },
    }),
  ]);

  console.log('âœ… Created 3 user preferences');

  // 10. Create User Interactions (for AI)
  console.log('ðŸ‘† Creating user interactions...');
  await Promise.all([
    prisma.userInteraction.create({
      data: {
        userId: tourists[0].id,
        serviceId: accommodations[0].id,
        type: 'BOOKING',
      },
    }),
    prisma.userInteraction.create({
      data: {
        userId: tourists[0].id,
        serviceId: tours[1].id,
        type: 'VIEW',
      },
    }),
    prisma.userInteraction.create({
      data: {
        userId: tourists[0].id,
        serviceId: accommodations[3].id,
        type: 'FAVORITE',
      },
    }),
    prisma.userInteraction.create({
      data: {
        userId: tourists[1].id,
        serviceId: tours[4].id,
        type: 'VIEW',
      },
    }),
    prisma.userInteraction.create({
      data: {
        userId: tourists[1].id,
        serviceId: accommodations[2].id,
        type: 'BOOKING',
      },
    }),
  ]);

  console.log('âœ… Created 5 user interactions');

  // 11. Create Social Features
  console.log('ðŸ‘¥ Creating social features...');

  // Friendships
  await Promise.all([
    prisma.friendship.create({
      data: {
        userId: tourists[0].id,
        friendId: tourists[1].id,
        status: 'ACCEPTED',
      },
    }),
    prisma.friendship.create({
      data: {
        userId: tourists[0].id,
        friendId: tourists[2].id,
        status: 'ACCEPTED',
      },
    }),
    prisma.friendship.create({
      data: {
        userId: tourists[1].id,
        friendId: tourists[3].id,
        status: 'PENDING',
      },
    }),
  ]);

  // Travel Stories
  await Promise.all([
    prisma.travelStory.create({
      data: {
        userId: tourists[0].id,
        locationId: locations[0].id,
        title: 'Magical Week in Dubrovnik',
        content:
          'Just returned from an incredible week in Dubrovnik. The Old Town is even more beautiful in person than in photos. We stayed at an amazing villa with sea views and took the Game of Thrones tour which was absolutely fantastic!',
        photos: [
          'https://images.unsplash.com/photo-1555990538-c5e0d8f1f3c3',
          'https://images.unsplash.com/photo-1602491453631-e2a5ad90a131',
        ],
        visibility: 'PUBLIC',
        likes: 15,
        serviceIds: [tours[0].id],
      },
    }),
    prisma.travelStory.create({
      data: {
        userId: tourists[2].id,
        locationId: locations[4].id,
        title: 'Plitvice Lakes - Nature at its Finest',
        content:
          'If you only visit one national park in Croatia, make it Plitvice! The cascading waterfalls and turquoise lakes are breathtaking. Spent 6 hours hiking the trails and it still wasn\'t enough.',
        photos: ['https://images.unsplash.com/photo-1567225591450-8ad43ad3c018'],
        visibility: 'PUBLIC',
        likes: 23,
      },
    }),
  ]);

  // Itineraries
  await prisma.tripItinerary.create({
    data: {
      userId: tourists[1].id,
      name: '7 Days Island Hopping Dalmatia',
      data: {
        days: [
          {
            day: 1,
            location: 'Split',
            activities: ['Diocletian Palace', 'Riva Promenade'],
          },
          {
            day: 2,
            location: 'Hvar',
            activities: ['Ferry to Hvar', 'Beach day', 'Sunset at Hula Hula'],
          },
          {
            day: 3,
            location: 'Vis',
            activities: ['Blue Cave tour', 'Stiniva Beach'],
          },
        ],
      },
      isPublic: true,
      sharedVersions: {
        create: {
          visibility: 'PUBLIC',
          views: 45,
          forks: 3,
        },
      },
    },
  });

  console.log('âœ… Created social features');

  // 12. Create Notifications
  console.log('ðŸ”” Creating notifications...');
  await Promise.all([
    prisma.notification.create({
      data: {
        userId: tourists[0].id,
        type: 'BOOKING_CONFIRMED',
        title: 'Booking Confirmed',
        message: 'Your booking for Luxury Villa with Sea View has been confirmed!',
        data: { bookingId: booking1.id },
        isRead: false,
      },
    }),
    prisma.notification.create({
      data: {
        userId: tourists[1].id,
        type: 'PRICE_DROP',
        title: 'Price Drop Alert',
        message: 'Blue Cave & Island Hopping Tour price dropped to â‚¬85!',
        data: { serviceId: tours[1].id },
        isRead: false,
      },
    }),
    prisma.notification.create({
      data: {
        userId: tourists[0].id,
        type: 'FRIEND_REQUEST',
        title: 'New Friend Request',
        message: 'Emma Brown sent you a friend request',
        data: { userId: tourists[3].id },
        isRead: true,
      },
    }),
  ]);

  console.log('âœ… Created 3 notifications');

  // Update service ratings
  console.log('ðŸ“Š Updating service ratings...');
  await prisma.service.update({
    where: { id: tours[0].id },
    data: { rating: 4.9, totalReviews: 78 },
  });
  await prisma.service.update({
    where: { id: accommodations[0].id },
    data: { rating: 4.8, totalReviews: 45 },
  });
  await prisma.service.update({
    where: { id: tours[1].id },
    data: { rating: 5.0, totalReviews: 112 },
  });

  console.log('âœ… Updated service ratings');

  console.log('\nðŸŽ‰ Database seeding completed successfully!\n');
  console.log('ðŸ“‹ Summary:');
  console.log(`   - ${tourists.length + supplierUsers.length + 1} Users (1 Admin, ${tourists.length} Tourists, ${supplierUsers.length} Suppliers)`);
  console.log(`   - ${locations.length} Locations`);
  console.log(`   - ${suppliers.length} Suppliers`);
  console.log(`   - ${allServices.length} Services`);
  console.log(`   - 4 Bookings`);
  console.log(`   - 4 Reviews`);
  console.log(`   - 2 Premium Subscriptions`);
  console.log(`   - 3 Supplier Add-ons`);
  console.log(`   - 3 User Preferences`);
  console.log(`   - Social Features (Friendships, Stories, Itineraries)`);
  console.log(`   - 3 Notifications`);
  console.log('\nðŸ“ Test Accounts:');
  console.log('   Admin:    admin@croffers.com / password123');
  console.log('   Tourist:  john@example.com / password123 (Premium Yearly)');
  console.log('   Tourist:  sarah@example.com / password123 (Premium Monthly)');
  console.log('   Tourist:  mike@example.com / password123');
  console.log('   Tourist:  emma@example.com / password123');
  console.log('   Supplier: supplier1@example.com / password123 (+ Add-ons)');
  console.log('   Supplier: supplier2@example.com / password123 (+ Add-on)');
  console.log('   Supplier: supplier3@example.com / password123');
  console.log('\nðŸš€ API running at: http://localhost:3333/api/v1');
  console.log('ðŸ“š Swagger docs: http://localhost:3333/api/docs\n');
}

main()
  .catch((e) => {
    console.error('âŒ Error seeding database:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
